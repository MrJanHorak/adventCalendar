// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  password      String
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  calendars     Calendar[]
  openedDoors   OpenedDoor[]
}

model Calendar {
  id                  String   @id @default(cuid())
  title               String
  description         String?
  shareId             String   @unique @default(cuid())
  userId              String
  theme               String?  @default("classic")
  backgroundColor     String?  @default("#f9fafb")
  backgroundPattern   String?  @default("none")
  primaryColor        String?  @default("#dc2626")
  secondaryColor      String?  @default("#16a34a")
  textColor           String?  @default("#111827")
  snowflakesEnabled   Boolean  @default(true)
  customDecoration    String?
  buttonStyle         String?  @default("gradient")
  buttonPrimaryColor  String?  @default("#dc2626")
  buttonSecondaryColor String? @default("#16a34a")
  dateButtonStyle     String?  @default("gradient")
  datePrimaryColor    String?  @default("#dc2626")
  dateSecondaryColor  String?  @default("#16a34a")
  dateTextColor       String?  @default("#ffffff")
  dateOpenedPrimaryColor String? @default("#16a34a")
  dateOpenedSecondaryColor String? @default("#22c55e")
  dateUnavailableColor String? @default("#d1d5db")
  dateBorderRadius    String?  @default("16px")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries     CalendarEntry[]
  openedDoors OpenedDoor[]

  @@index([userId])
  @@index([shareId])
}

model CalendarEntry {
  id              String   @id @default(cuid())
  day             Int      // 1-25
  title           String
  content         String?  @db.Text
  imageUrl        String?
  videoUrl        String?
  linkUrl         String?
  linkText        String?
  type            EntryType @default(TEXT)
  isPoem          Boolean  @default(false)
  fontFamily      String?  @default("Inter")
  fontSize        String?  @default("16px")
  textColor       String?  @default("#000000")
  backgroundColor String?
  textAlign       String?  @default("center")
  verticalAlign   String?  @default("middle")
  borderColor     String?
  borderWidth     String?  @default("0px")
  borderStyle     String?  @default("solid")
  borderRadius    String?  @default("0px")
  padding         String?  @default("16px")
  boxShadow       String?  @default("none")
  backgroundGradientEnabled Boolean? @default(false)
  backgroundGradientColor2 String?
  borderGradientEnabled    Boolean? @default(false)
  borderGradientColor2     String?
  // Decorations: optional per-entry visual effects
  decorationEnabled        Boolean   @default(false)
  decorationType           DecorationType?
  decorationOptions        Json?
  calendarId      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)

  @@unique([calendarId, day])
  @@index([calendarId])
}

model OpenedDoor {
  id         String   @id @default(cuid())
  day        Int      // 1-25
  userId     String?  // Optional to support anonymous users
  calendarId String
  openedAt   DateTime @default(now())

  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([calendarId])
  @@index([calendarId, day])
}

enum EntryType {
  TEXT
  POEM
  IMAGE
  VIDEO
}

// Supported decoration types
enum DecorationType {
  SNOW
  LIGHTS
  GLOW
  CONFETTI
  STARS
  CANDLE
  AURORA
  RIBBONS
}
